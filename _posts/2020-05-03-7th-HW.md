---
layout: post
author: Younji Kim
---
# Linux
## 컴퓨터 시스템 관리
### 20190960 김윤지

_ _ _
이번 주차에선 셸 스크립트와 셸 스크립트를 프로그래밍 하는 법, 예약 기능의 cron과 at에 대하여 공부하였다.        
1. **Shell이란?**          
사용자의 명령을 해석하여 커널에게 전달한다. 셸에는 bash를 포함하여 여러가지 종류가 있다.             
shell script : 명령어들의 집합이다.          
bash : 브라이언 폭스가 발표한 유닉스 전용 셸이다. 우분투에서 기본으로 사용한다.              
존재하는 명령어들에 대한 별명을 붙일 수 있는 Alias, 키보드의 화살표를 눌러서 전에 썼던 명령어들을 볼 수 있는 History, 연산과 Tab키를 눌러서 쓸 수 있는 자동 이름 완성 등의 여러가지 기능들을 제공한다.           
환경 변수 : 셸에 이미 정의되어있는 변수이다. 환경 변수를 참조함으로써 소프트웨어가 컴퓨터의 정보에 대해 접근 할 수 있으므로 응용 소프트웨어 내의 여러 작업들에는 환경 변수가 필요하다. 웹 브라우저의 내부 데이터 중의 일부를 환경 변수라고 하기도 한다. 참고:<https://terms.naver.com/entry.nhn?docId=1232066&cid=40942&categoryId=32848>          
2. **셸 스크립트 프로그래밍**        
(1) 변수      
C언어와 달리 미리 선언하지 않는다. 처음 변수에 값이 할당되면 자동으로 변수가 생성된다. 변수에 넣는 값들은 모두 문자열 취급. 그러므로 연산을 위해 숫자로 바꾸고 싶을 때에는 expr 키워드를 앞에다 추가하며, 수식은 `(백쿼트)로 감싼다.       
변수의 값을 사용하기 위해서는 변수명 앞에 $를 붙인다. 다만 변수에 값을 대입할 때에는 $를 사용하지 않는다.       
대소문자 구분하며, 대입연산자(=) 좌우에는 공백이 없어야한다.       
파라미터 변수는 $0, $1..... 명령의 각 부분을 변수로 지정한다. 예) sh info.sh($0) -옵션($1)        
           
(2) 조건문      
```
if [ condition ]; then      
 ( 조건 만족했을 때 실행할 명령어들~~~)      
else     
fi
```
case의 패턴에는 *(와일드카드)를 사용할 수 있다. 조건문에는 관계 연산자인 &&와 ||를 사용한다.          
        
(3) 반복문
일정 범위 또는 조건이 참인 동안 반복할 명령어를 반복 실행한다.         
```
for variable in range; do       
(명령어들~~~)       
done
```
```
while [ condition ]; do      
(명령어들~~~)       
done         
```
             
(4) 사용자 정의 함수     
사용자가 직접 함수를 작성하고 호출할 수 있다. 호출 할 때 파라미터를 붙여서 사용가능.       
               
(5) 그 외      
eval : 문자열을 명령어로 인식하고 실행한다.     
export : 외부 변수로 선언한다. 선언한 변수를 다른 프로그램에서도 사용할 수 있다.       
set과 $ : 리눅스 명령을 결과로  사용하려면 $형식을 사용해아한다. 결과를 파라미터로 사용할 때 set을 사용한다.         
shift : 파라미터 변수를 왼쪽으로 한 단계씩 아래로 이동시킨다.          
3. **cron과 at**
- cron       
*주기적으로 반복되는 일*을 자동으로 실행할 수 있도록 시스템 작업을 예약한다.             
/etc/crontab에 sh파일 위치시킨다.        
- at         
*일회성 작업*을 예약한다. at 시간 날짜(tommorow 등), 취소는 atrm 작업번호.           

_ _ _

![](https://github.com/objectio/objectio.github/blob/master/images/7-2.JPG?raw=true)          
연산하는 실습을 따라하다가 헷갈리는 점이 있었다. =(대입연산자)를 쓸 때에는 공백이 있으면 안되는데, 왜 +, - 등의 연산자들을 쓸 때에는 공백을 꼭 넣어야하는가?라는 궁금증이 생겼다. 그래서 인터넷을 뒤져 납득할 만한 이유를 알아내었다.      
<https://devnata.tistory.com/23> 연산 방법에 대해 설명하는 글을 보면, 공백을 넣지 않을 경우에는 그대로 문자열로 인식되서 연산이 안된다는 것! 변수에 대해 배울 때 변수에 넣는 값은 무조건 문자열로 취급된다고 배웠는데 `, expr 말고도 공백도 문자열과 수식을 구별하게 해주는 도구인 듯하다.           
![](https://github.com/objectio/objectio.github/blob/master/images/7-3.JPG?raw=true)           
위에서부터 5줄만 출력하는 실습을 진행하다가 출력이 안되서 띠용했다. vi에디터를 열여서 봐보니 if [ -f $fname ] && [ -s $fname ]; then 줄에서 -s $fmame으로 되어있었다. 변수 색깔이 어두운 파란색이라 잘 안보여서 처음 봤을 때는 오타가 없는 줄 알았다. 앞으로 더 조심해야겠다!        

_ _ _

bash 등의 셸과 셸 스크립트를 프로그래밍 하는 방법, 그리고 조기퇴근을 하기 위해 필수적인 cron과 at을 배웠다. 이해에 어려움이 있는 부분은 없었던 것 같다. 깃허브를 다루게 되면서 git에 대해서도 많이 알아가고 있는데 컴퓨터의 로컬 파일들을 깃허브 사이트에 올리기 위해서 쓰는 git bash덕분에 셸과 bash의 개념을 헷갈리지 않을 수 있었다. 셸의 한 종류가 배쉬! 셸 스크립트들을 프로그래밍 하는 법에 대해서도 배웠는데 진짜 프로그래밍은 배우면 배울 수록 배워야하는 게 갈수록 늘어나는 것 같다. 문법도 지금까지 배워오던 다른 언어들의 문법들과 조금씩 달라서 서로 혼용해서 쓰지 않게 주의를 기울여야 될 듯. cron과 at은 초반에 교수님이 온라인 게임에서의 정기점검에 빗대어 예시를 들어주셔서 쉽게 이해 가능했다. 시간을 지정해서 백업할 수 있는 기능이라니... 정말 필수적이다. 과제하느라 배쉬 스크립트에 대해 구글링하고 맘에 드는 스크립트를 찾아보는데 꽤 끌리는 스크립트들이 많았다. 과제에서 쓴 패키지 중에서 weather라는 스크립트였는데 날씨를 텍스트 뿐만이 아니라 -이나 ( 등을 이용해서 구름이나 태양 등을 그림으로 나타내는 게 정말 신기했다. 또 moon이라고 치면 여러가지 색깔로 이루어진 그림이 나와서 눈호강을 할 수 있었다. 이런 여러가지 스크립트들을 보면서 셸 스크립트 프로그래밍에 대해 더 많이 알아간 다음 내가 직접 스크립트를 짜보고 싶다는 생각이 들었다. echo는 C언어로 치면 printf.. read는 scanf... 잘 기억해두자!    

_ _ _

## 과제
![](https://github.com/objectio/objectio.github/blob/master/images/7-hw.JPG?raw=true)       
bash script : geo        
유용한 이유 : 인터넷에 필요한 각종 IP들과 DNS서버이름 등의 여러 정보들을 보여주기에 네트워크 상의 여러 작업들을 수행 할 때 필수적일 것 같아서 선정하였다.      
해당 스크립트 설명 : 사람들이 많이 사용하는 bash scripts모음집인 Bash-Snippets에서 가져왔다. 깃허브에 등록되어있는 패키지로, 다음은 geo의 전체적인 코드가 들어있는 링크이다. Alexanderepstein의 깃허브<https://github.com/alexanderepstein/Bash-Snippets/blob/master/geo/geo>. 여러 IP들을 출력하기 위해서는 각 IP마다 탐색하는 함수들을 작성해야한다. 모든 코드를 분석하기에는 함수의 양이 너무 많아서 그 중 몇가지만 분석할 것이다.       
```
wan_search() {
  httpGet https://api.ipify.org
}
```
WAN IP주소를 탐색하는 함수이다. 내 ip를 볼 수 있는 사이트인 api.ipify.org를 참조하여 그 값을 가져온다.        
```
lan_search() {
  if [ "$(uname)" = "Darwin" ]; then
    ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
  elif [ "$(uname -s)" = "Linux" ]; then
    ip addr show | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
  else
    echo "OS not supported"
    exit 1
  fi
}
```
LAN IP를 탐색하는 함수이다. uname이 Darwin이라는 것은 MacOS X를 쓰는 컴퓨터란 뜻이므로 그 운영체제에 대한 ip주소를 도출해내고, elif 조건의 Linux를 이용하는 유저의 경우에는 리눅스 운영체제에 대한 ip주소를 도출해내는 코드이다. MacOs X와 Linux만 bash를 지원하므로 그 외의 운영체제는 지원을 하지 않는다는 메세지를 출력한다.