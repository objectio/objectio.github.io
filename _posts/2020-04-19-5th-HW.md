---
layout: post
author: Younji Kim
---
# Linux
## 컴퓨터 시스템 관리
### 20190960 김윤지

_ _ _

리눅스에서 디스크 관리를 어떻게 하는지에 배우고, 여러 개의 하드디스크를 하나의 디스크처럼 사용할 수 있도록 묶어보는 5주차 수업!
배운 내용은 다음과 같다.      

1. **리눅스의 파일 시스템**
 - 디렉터리란?
    파일 또는 다른 디렉터리를 보관하는 특수한 파일이다.(윈도우에서는 폴더)
 - 파일 시스템의 종류: ext4, XFS, Btrfs 등
    저장장치의 데이터 구조이며, 처리하는 프로그램들이 각자 다르다. 
 - 만약 파일 시스템이 없다면?
    파일을 생성하는 응용프로그램들이 일일히 파일의 이름, 저장장소, 용량을 전부 기억하고 있어야 한다.
 - 파일 시스템이 깨진 경우에는?
    Atomic 처리를 허용하지 않기 때문에 Joirnaling, Copy on write 같은 방지 기술을 통해 해결한다.
    
2. **하드디스크**
 - SATA
   하드 디스크 또는 광학 드라이브와 데이터 전송을 주요 목적으로 만든 컴퓨터 버스이다. 네이버 지식백과(https://terms.naver.com/entry.nhn?docId=3573312&cid=59088&categoryId=59096)에서 찾아보았더니 기존의 PATA를 대체하기 위해 나온 인터페이스라고 한다.
 - SCSI
    컴퓨터에 주변기기를 연결할 때 직렬 방식으로 연결하기 위한 표준이다.
 - 파티션(Partition)
   말 그대로 하나의 하드디스크를 나눈 것이다. 종류는 Primary, Extended, Logical 파티션이 있다.
 
3. **RAID**
 여러개의 디스크들을 하나의 하드디스크처럼 사용하는 방식이다. 주로 사용되는 레벨은 Linear RAID, RAID0, RAID1, RAID5, RAID6, RAID1+0이 있다.
 - Linear RAID
   최소 2개 이상의 하드디스크가 필요하다. 앞 디스크부터 연걸된 것처럼 순서대로 저장한다.
 - RAID0
   최소 2개 이상의 하드디스크가 필요하다. 모든 디스크에 동시에 저장(striping)하기 때문에 공간 효울성이 높다.
 - RAID1
   최소 2개 이상의 하드디스크가 필요하다. 하나의 데이터를 두 군데의 하드디스크에 저장(mirroring)한다. 하드디스크 개수/2의 공간만큼 사용한다. 신뢰성이 높다.
 - RAID5
   최소 3개 이상의 하드디스크가 필요핟. 데이터가 안전하며, 공간 효율성 또한 겸비하고 있다. 하나의 하드디스크에서 오류가 발생했을 떄, 패리티를 이용하여 데이터를 복구한다. 하드디스크 개수-1 만큼의 공간을 사용한다. 한가지의 하드디스크가 고장났을 경우에만 복구 가능! (두 개는 RAID6에서 복구 가능)
 - RAID 문제 복구
   SCSI 명령어를 이용해 하드디스크를 교체한 후 각 RAID들을 복구한다.

_ _ _

#### 과제
<img src="https://github.com/objectio/objectio.github.io/blob/master/images/5-hw.JPG?raw=true" width="100%">         
          
5주차 실습과제는 자신이 생각하기에 가장 적절해보이는 RAID를 선택하여 Server(B)에 구성해보는 것이었다. 나는 RAID5를 선택했다. LinearRAID나 RAID0는 완전한 공간 효율성을 자랑하는 대신 안전성이 없고 RAID1은 데이터 안전성은 매우 보장되지만 공간 효율이 매우 나쁘다. 강점은 완벽하지만 약점은 너무 허술한 것보다는 어느 정도 사이에 걸쳐있어 두 가지를 커버하는 게 좋다고 생각한다. 그렇다고 RAID5는 간신히 데이터 안전성과 공간 효율성을 보장하고 있는 게 아니다. 하나의 하드디스크 오류가 발생했을 때에 한해서지만 '패리티'를 이용하여 공간을 절약하면서도 데이터를 복구할 수 있어 두 가지 특성(안전성과 공간효율성) 모두 뛰어나기 때문에 선택하였다.

_ _ _

강의내용을 숙지하고 교수님을 따라 실습을 진행하려는데 처음부터 에러가 나왔다.      
![](https://github.com/objectio/objectio.github.io/blob/master/images/5-error1.JPG?raw=true)        
나와 같은 오류메세지가 뜬 사람의 블로그(https://kairosre.tistory.com/1201)에서 원인을 알게 되었다. 직전에 vmware를 이용할 때 비정상적으로 껐기 때문에 가상머신이 아직까지 실행중이라고 인식하여 제대로 작동하지 않는다는 것이었다. C:/Linux/Server 경로로 들어가서 Server.vmx.lck이라는 파일을 지우고 다시 실행하면 정상 작동 된다.

한가지 더 오류가 발생했었다. RAID 구성을 하고 재부팅을 하는데 다음과 같이 에러사항이 있어 부팅이 안되었다.       
![](https://github.com/objectio/objectio.github.io/blob/master/images/5-error2.JPG?raw=true)       
구글링을 통해 찾은 사이트(https://muaadelsharif.blogspot.com/2016/09/how-to-fix-and-prevent-devsda1.html)를 통해 맨 위의 /dev/sda1: recovering journal이라는 메세지는 USB포트에 연결되있는 장치를 뺐더니 해결된다는 것을 발견했다. 그러나 Started bpfilter라는 오류메세지는 계속 사라지지 않아서 구글링을 한 두시간정도 한 것 같다. 개발자 답변 사이트(https://askubuntu.com/questions/1084550/ubuntu-18-10-stuck-on-started-bpfilter-while-booting)를 보았는데, 여기에 나와 있는 무슨 수를 써도 부팅이 제대로 되지 않고, 컴퓨터 내에 어떤 프로그램과 bpfilter가 충돌해서 나타나는 오류메세지라는 것만 찾았다. 결국 구글링으로는 해결 방법을 못 찾고 교수님의 다음 실습으로 넘어갔는데 어이없게도 내 /etc/fstab파일에서 defaults를 default로 모두 잘못 적혀 있었다. vi에디터를 이용해 전부 고친 후 재부팅 했더니 정상 작동 되었다. 진짜 허탈했다...      

_ _ _

디스크 관리에 대해 알아본 5주차 수업은 여러모로 다사다난했다. vmware부팅부터 제대로 안되고 중간중간 종잡을 수 없는 오류도 많이 발생했고... 지금까지 배웠던 수업 중 가장 내 미간이 좁혀져 있던 시간이었던 것 같다. 혹시나 해서 컴시관 질의응답 게시판 가보니 나와 똑같이 default 오타가 발생한 사람도 있던데 왜 내 가상머신은 불친절하게 어디에서 오류가 났다는 사실을 안 가르쳐 주었는지 아직까지도 미스테리다. 하지만 덕분에 여러 사이트들을 돌아다니면서, 대부분의 사람들은 응급 모드에서 GUI환경으로 넘어가지지 않을 때 slim이나 LightDM, GDM3 등의 프로그램을 이용하여 일시적으로 GUI환경에 들어가 오류가 난 곳을 찾아 고친다는 걸 알게 되었다. 또 RAID 관련 오류 때문에 몇번 씩 강의를 다시 듣고 따라해봤더니 처음에는 이해하기 힘들었던 하드디스크 추가부터 RAID로 묶는 일련의 과정(fdisk로 파티션을 할당하고 mkfs와 ext4로 파일 시스템을 생성한 뒤 마운트 하기 위한 디렉터리를 만들고 mount로 마운트한 후, mdadm --create, --detail로 RAID를 구성한다.)을 이해하고 숙지하게 된 것 같다.